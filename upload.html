<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learnify - Upload Resources</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="assets/images/logo.png" type="image/png">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #f8f9fa;
            --text-color: #333;
            --light-text: #777;
            --dark-bg: #1a1a2e;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --error-color: #ff4757;
            --success-color: #2ed573;
        }

        [data-theme="dark"] {
            --primary-color: #5d78ff;
            --secondary-color: #16213e;
            --text-color: #f0f0f0;
            --light-text: #b0b0b0;
            --dark-bg: #0f0f23;
            --card-bg: #1a1a2e;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --error-color: #ff6b81;
            --success-color: #7bed9f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            transition: var(--transition);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            height: 40px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
        }

        .nav-links a.active {
            color: var(--primary-color);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: var(--primary-color);
            transition: var(--transition);
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: rotate(30deg);
        }

        .upload-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .upload-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .upload-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .upload-header p {
            color: var(--light-text);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input, 
        .form-group select, 
        .form-group textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--light-text);
            border-radius: 5px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            transition: var(--transition);
        }

        .form-group input:focus, 
        .form-group select:focus, 
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 107, 255, 0.2);
        }

        .file-upload {
            border: 2px dashed var(--light-text);
            padding: 2rem;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-upload:hover {
            border-color: var(--primary-color);
        }

        .file-upload i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .file-upload p {
            margin-bottom: 0.5rem;
        }

        .file-upload small {
            color: var(--light-text);
        }

        #fileInput {
            display: none;
        }

        .upload-btn {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-btn:hover {
            background-color: #3a56e0;
        }

        .upload-btn:disabled {
            background-color: var(--light-text);
            cursor: not-allowed;
        }

        .progress-container {
            margin-top: 1rem;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: var(--light-text);
        }

        .error-message {
            color: var(--error-color);
            margin-top: 1rem;
            font-size: 0.9rem;
            text-align: center;
        }

        .success-message {
            background-color: var(--success-color);
            color: white;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
            text-align: center;
        }

        .file-info {
            margin-top: 1rem;
            padding: 0.5rem;
            background-color: rgba(74, 107, 255, 0.1);
            border-radius: 5px;
            display: none;
        }

        .file-info p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .upload-container {
                margin: 1rem;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="logo-container">
                <img src="assets/images/logo.png" alt="Learnify Logo" class="logo">
                <h1>Learnify</h1>
            </div>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/upload" class="active">Upload</a>
                <a href="/admin">Admin</a>
                <a href="/terms">Terms</a>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </nav>
    </header>

    <div class="upload-container">
        <div class="upload-header">
            <h2>Share Your Knowledge</h2>
            <p>Upload textbooks, exam papers, marking schemes or syllabi to help others learn</p>
        </div>

        <div class="success-message" id="successMessage"></div>
        <div class="error-message" id="errorMessage"></div>

        <form id="uploadForm">
            <div class="form-group">
                <label for="title">Resource Title</label>
                <input type="text" id="title" placeholder="e.g. Mathematics Paper 1 2025" required>
            </div>

            <div class="form-group">
                <label for="level">Level</label>
                <select id="level" required>
                    <option value="">Select level</option>
                    <option value="O Level">O Level</option>
                    <option value="A Level">A Level</option>
                </select>
            </div>

            <div class="form-group">
                <label for="type">Resource Type</label>
                <select id="type" required>
                    <option value="">Select type</option>
                    <option value="Textbook">Textbook</option>
                    <option value="Question Paper">Question Paper</option>
                    <option value="Marking Scheme">Marking Scheme</option>
                    <option value="Syllabus">Syllabus</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="uploader">Your Name (for credit)</label>
                <input type="text" id="uploader" placeholder="e.g. Darrell Mucheri" required>
            </div>

            <div class="form-group">
                <label for="description">Description (optional)</label>
                <textarea id="description" rows="3" placeholder="Brief description of the resource"></textarea>
            </div>

            <div class="form-group">
                <label>Upload File (PDF or DOCX, max 100MB)</label>
                <div class="file-upload" id="fileUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Click to browse or drag and drop</p>
                    <small>Supported formats: .pdf, .docx</small>
                    <input type="file" id="fileInput" accept=".pdf,.docx">
                </div>
                <div class="file-info" id="fileInfo">
                    <p><strong>Selected file:</strong> <span id="fileName">No file selected</span></p>
                    <p><strong>File size:</strong> <span id="fileSize">0 MB</span></p>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText">Uploading: 0%</div>
            </div>

            <button type="submit" class="upload-btn" id="uploadBtn" disabled>Upload Resource</button>
        </form>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBId6e837ZmLhkzvDozFeJyn0EXUhF_Ftg",
            authDomain: "zimxcel.firebaseapp.com",
            projectId: "zimxcel",
            storageBucket: "zimxcel.appspot.com",
            messagingSenderId: "73188096891",
            appId: "1:73188096891:web:ed9a0b34ff8d9dc79b5bde",
            measurementId: "G-38VCEG9G6R"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // DOM elements
        const themeToggle = document.getElementById('themeToggle');
        const uploadForm = document.getElementById('uploadForm');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadBtn = document.getElementById('uploadBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        // Theme toggle functionality
        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            
            const icon = themeToggle.querySelector('i');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            localStorage.setItem('theme', newTheme);
        });

        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        const icon = themeToggle.querySelector('i');
        icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

        // File upload handling
        fileUploadArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                // Validate file type
                const validTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
                if (!validTypes.includes(file.type)) {
                    errorMessage.textContent = 'Only PDF and DOCX files are allowed';
                    fileInput.value = '';
                    return;
                }
                
                // Validate file size (100MB max)
                if (file.size > 100 * 1024 * 1024) {
                    errorMessage.textContent = 'File size exceeds 100MB limit';
                    fileInput.value = '';
                    return;
                }
                
                // Display file info
                fileName.textContent = file.name;
                fileSize.textContent = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
                fileInfo.style.display = 'block';
                errorMessage.textContent = '';
                uploadBtn.disabled = false;
            }
        });

        // Drag and drop functionality
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = 'var(--primary-color)';
            fileUploadArea.style.backgroundColor = 'rgba(74, 107, 255, 0.1)';
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.style.borderColor = 'var(--light-text)';
            fileUploadArea.style.backgroundColor = 'transparent';
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.style.borderColor = 'var(--light-text)';
            fileUploadArea.style.backgroundColor = 'transparent';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        });

        // Form submission
        uploadForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const title = document.getElementById('title').value.trim();
            const level = document.getElementById('level').value;
            const type = document.getElementById('type').value;
            const uploader = document.getElementById('uploader').value.trim();
            const description = document.getElementById('description').value.trim();
            const file = fileInput.files[0];
            
            // Validate form
            if (!title || !level || !type || !uploader || !file) {
                errorMessage.textContent = 'Please fill all required fields';
                return;
            }
            
            // Disable upload button
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Uploading...';
            progressContainer.style.display = 'block';
            
            // Create a unique filename
            const fileExt = file.name.split('.').pop();
            const filename = `${title.replace(/\s+/g, '_')}_${Date.now()}.${fileExt}`;
            
            // Upload file to Firebase Storage
            const storageRef = storage.ref(`resources/${filename}`);
            const uploadTask = storageRef.put(file);
            
            // Track upload progress
            uploadTask.on('state_changed',
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = `${progress}%`;
                    progressText.textContent = `Uploading: ${Math.round(progress)}%`;
                },
                (error) => {
                    console.error('Upload error:', error);
                    errorMessage.textContent = 'Upload failed. Please try again.';
                    uploadBtn.disabled = false;
                    uploadBtn.textContent = 'Upload Resource';
                    progressContainer.style.display = 'none';
                },
                () => {
                    // Upload complete
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        // Save resource data to Firestore
                        const resourceData = {
                            title,
                            level,
                            type,
                            uploader,
                            description,
                            fileUrl: downloadURL,
                            uploadDate: new Date(),
                            downloads: 0,
                            keywords: generateKeywords(title, level, type)
                        };
                        
                        db.collection('resources').add(resourceData)
                            .then(() => {
                                // Success
                                successMessage.textContent = 'Resource uploaded successfully!';
                                successMessage.style.display = 'block';
                                
                                // Reset form
                                uploadForm.reset();
                                fileInfo.style.display = 'none';
                                progressContainer.style.display = 'none';
                                uploadBtn.disabled = true;
                                uploadBtn.textContent = 'Upload Resource';
                                
                                // Hide success message after 5 seconds
                                setTimeout(() => {
                                    successMessage.style.display = 'none';
                                }, 5000);
                            })
                            .catch((error) => {
                                console.error('Error saving resource:', error);
                                errorMessage.textContent = 'Error saving resource data. Please try again.';
                                uploadBtn.disabled = false;
                                uploadBtn.textContent = 'Upload Resource';
                                progressContainer.style.display = 'none';
                            });
                    });
                }
            );
        });

        // Generate search keywords
        function generateKeywords(title, level, type) {
            const keywords = [];
            
            // Add title words
            keywords.push(...title.toLowerCase().split(/\s+/));
            
            // Add level variations
            keywords.push(level.toLowerCase());
            if (level.includes('O Level')) keywords.push('o-level', 'olevel');
            if (level.includes('A Level')) keywords.push('a-level', 'alevel');
            
            // Add type variations
            keywords.push(type.toLowerCase());
            if (type === 'Question Paper')) keywords.push('paper', 'exam', 'questions');
            if (type === 'Marking Scheme')) keywords.push('markscheme', 'answers');
            
            return [...new Set(keywords)]; // Remove duplicates
        }
    </script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
</body>
</html>
